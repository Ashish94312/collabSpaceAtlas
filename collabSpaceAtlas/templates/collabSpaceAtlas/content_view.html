{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ content.title }}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      font-size: 16px;
      line-height: 1.7;
      color: #2d3748;
      background-color: #ffffff;
    }
    
    .prose {
      max-width: none;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      color: #2d3748;
    }
    
    .prose p {
      margin: 1.25rem 0;
      line-height: 1.75;
      font-size: 16px;
      color: #2d3748;
    }
    
    .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
      font-weight: 600;
      color: #1a202c;
      margin-top: 2rem;
      margin-bottom: 1rem;
      line-height: 1.3;
    }
    
    .prose h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-top: 0;
      margin-bottom: 1.5rem;
      border-bottom: 1px solid #e2e8f0;
      padding-bottom: 0.75rem;
    }
    
    .prose h2 {
      font-size: 1.625rem;
      margin-top: 2.5rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid #e2e8f0;
      padding-bottom: 0.5rem;
    }
    
    .prose h3 {
      font-size: 1.375rem;
      margin-top: 2rem;
    }
    
    .prose h4 {
      font-size: 1.125rem;
      margin-top: 1.5rem;
    }
    
    .prose ul, .prose ol {
      margin: 1.25rem 0;
      padding-left: 1.75rem;
    }
    
    .prose li {
      margin: 0.5rem 0;
      line-height: 1.75;
    }
    
    .prose strong {
      font-weight: 600;
      color: #1a202c;
    }
    
    .prose em {
      font-style: italic;
      color: #4a5568;
    }
    
    .prose a {
      color: #3182ce;
      text-decoration: none;
      border-bottom: 1px solid #cbd5e0;
      transition: border-color 0.2s;
    }
    
    .prose a:hover {
      color: #2c5282;
      border-bottom-color: #3182ce;
    }
    
    .prose code {
      background-color: #f7fafc;
      padding: 0.2rem 0.4rem;
      border-radius: 0.25rem;
      font-size: 0.9em;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      color: #e53e3e;
      border: 1px solid #e2e8f0;
    }
    
    .prose pre {
      background-color: #1a202c;
      color: #e2e8f0;
      padding: 1.25rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      margin: 1.5rem 0;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
    }
    
    .prose pre code {
      background-color: transparent;
      padding: 0;
      color: #e2e8f0;
      border: none;
      font-size: 14px;
    }
    
    .prose img {
      max-width: 100%;
      height: auto;
      border-radius: 0.5rem;
      margin: 2rem 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .prose table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
      font-size: 15px;
    }
    
    .prose table th,
    .prose table td {
      border: 1px solid #e2e8f0;
      padding: 0.75rem 1rem;
      text-align: left;
    }
    
    .prose table th {
      background-color: #f7fafc;
      font-weight: 600;
      color: #1a202c;
    }
    
    .prose table td {
      color: #2d3748;
    }
    
    .prose blockquote {
      border-left: 3px solid #4299e1;
      padding-left: 1.25rem;
      margin: 1.5rem 0;
      color: #4a5568;
      font-style: italic;
      background-color: #f7fafc;
      padding: 1rem 1.25rem;
      border-radius: 0.375rem;
    }
    
    .math-block {
      text-align: center;
      margin: 2rem 0;
      padding: 1.25rem;
      background-color: #f7fafc;
      border-radius: 0.5rem;
      overflow-x: auto;
      border: 1px solid #e2e8f0;
    }
    
    .math-inline {
      display: inline-block;
      margin: 0 0.15em;
    }
    
    .markdown-content {
      max-width: 700px;
      margin: 0 auto;
    }
    
    @media (max-width: 768px) {
      body {
        font-size: 15px;
      }
      .prose p {
        font-size: 15px;
      }
      .prose h1 {
        font-size: 1.75rem;
      }
      .prose h2 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body class="bg-white">
  <nav class="bg-white border-b shadow-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-3">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <a href="{% url 'content-list' %}" class="text-blue-600 hover:text-blue-800 font-medium">
            ← Library
          </a>
          <div class="h-6 w-px bg-gray-300"></div>
          <h1 class="text-xl font-bold text-gray-900">{{ content.title }}</h1>
        </div>
      </div>
    </div>
  </nav>

  <div class="max-w-4xl mx-auto px-6 py-8">
    <article class="prose prose-lg max-w-none">
      <div class="markdown-content">
      <header class="mb-8">
        <h1 class="text-4xl font-bold mb-2">{{ content.title }}</h1>
        
        <div class="flex items-center space-x-4 text-sm text-gray-500 mb-4">
          {% if content.estimated_time %}
          <span>{{ content.estimated_time }} min read</span>
          {% endif %}
          {% if content.difficulty %}
          <span class="px-2 py-1 bg-gray-100 rounded">{{ content.difficulty|title }}</span>
          {% endif %}
          {% if content.version %}
          <span>v{{ content.version }}</span>
          {% endif %}
        </div>
        
        {% if content.tags %}
        <div class="flex flex-wrap gap-2 mb-4">
          {% for tag in content.tags %}
          <span class="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded">{{ tag }}</span>
          {% endfor %}
        </div>
        {% endif %}
        
        {% if content.authors %}
        <div class="text-sm text-gray-600">
          <strong>Authors:</strong> {{ content.authors|join:", " }}
        </div>
        {% endif %}
      </header>

        {{ content.html_content|safe }}
      </div>
    </article>

    <div class="mt-12 pt-8 border-t">
      <div class="flex items-center justify-between">
        <a href="{% url 'content-list' %}" class="text-blue-600 hover:text-blue-800 font-medium">
          ← Back to Library
        </a>
        
        <div class="flex items-center space-x-4">
          {% if prev_item %}
          <a href="{% if prev_item.is_topic %}{% url 'content-list' %}?topic={{ prev_item.slug }}{% else %}{% url 'content-view' slug=prev_item.slug %}{% endif %}" 
             class="flex items-center space-x-2 text-blue-600 hover:text-blue-800 font-medium">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            <span>Previous: {{ prev_item.title }}</span>
          </a>
          {% endif %}
          
          {% if next_item %}
          <a href="{% if next_item.is_topic %}{% url 'content-list' %}?topic={{ next_item.slug }}{% else %}{% url 'content-view' slug=next_item.slug %}{% endif %}" 
             class="flex items-center space-x-2 text-blue-600 hover:text-blue-800 font-medium bg-blue-50 px-4 py-2 rounded-lg hover:bg-blue-100">
            <span>Next: {{ next_item.title }}</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Highlight code blocks
      document.querySelectorAll('pre code').forEach(function(block) {
        hljs.highlightElement(block);
      });
      
      // Typeset math after content loads
      setTimeout(function() {
        if (window.MathJax && window.MathJax.typesetPromise) {
          window.MathJax.typesetPromise();
        }
      }, 500);
      
      // Process images - make them responsive
      document.querySelectorAll('.markdown-content img').forEach(function(img) {
        if (!img.hasAttribute('loading')) {
          img.setAttribute('loading', 'lazy');
        }
      });
    });
  </script>
</body>
</html>
